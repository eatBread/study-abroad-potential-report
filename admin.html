<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留学潜力报告生成系统 - 管理后台</title>
    <link rel="stylesheet" href="styles/main.css">
    <!-- 使用国内镜像，避免Google Fonts超时 -->
    <style>
        @import url('https://fonts.loli.net/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        /* 后备字体方案 */
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', 'Helvetica Neue', Arial, sans-serif !important;
        }
    </style>
    <!-- 添加xlsx库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>留学潜力报告生成系统</h1>
                    <p>基于科学评估的个性化留学规划报告</p>
                </div>
                <div class="header-actions">
                    <a href="home.html" class="btn btn-outline">🏠 返回首页</a>
                    <a href="survey.html" class="btn btn-outline">📋 在线问卷</a>
                    <a href="test-global-logos.html" target="_blank" class="btn btn-secondary">
                        <span class="btn-icon">🏛️</span>
                        查看校徽列表
                    </a>
                </div>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn" onclick="window.location.href='home.html'">🏠 首页</button>
            <button class="tab-btn" onclick="window.location.href='survey.html'">📋 在线问卷</button>
            <button class="tab-btn active" onclick="showTab('excel')">📊 Excel导入</button>
            <button class="tab-btn" onclick="showTab('surveys')">📝 问卷管理</button>
            <button class="tab-btn" onclick="showTab('input')">✏️ 学生信息录入</button>
            <button class="tab-btn" onclick="showTab('admin')">📋 推荐信息录入</button>
            <button class="tab-btn" onclick="showTab('institutions')">🔑 机构码管理</button>
        </nav>

        <!-- Excel导入页面 -->
        <div id="excel-tab" class="tab-content active">
            <div class="form-container">
                <h2>Excel文件导入</h2>
                <div class="upload-section">
                    <div class="upload-area">
                        <input type="file" id="xlsxFile" accept=".xlsx,.xls" style="display: none;" />
                        <div class="upload-box" onclick="document.getElementById('xlsxFile').click()">
                            <div class="upload-icon">📁</div>
                            <div class="upload-text">
                                <p>点击选择Excel文件</p>
                                <p class="upload-hint">支持 .xlsx 和 .xls 格式</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="processXlsxFile()" id="processBtn" disabled>处理Excel文件</button>
                    </div>
                    
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <h3>文件信息</h3>
                        <div id="fileDetails"></div>
                    </div>
                </div>

                <div class="data-preview" id="dataPreview" style="display: none;">
                    <h3>数据预览</h3>
                    <div class="preview-controls">
                        <button class="btn btn-secondary" onclick="exportToJson()">导出为JSON</button>
                        <button class="btn btn-primary" onclick="generateReportsFromExcel()">生成所有报告</button>
                        <button class="btn btn-secondary" onclick="viewAllReports()" id="viewReportsBtn" style="display: none;">查看所有报告</button>
                        <button class="btn btn-primary" onclick="fillStudentFormFromExcel(0)" id="fillFormBtn" style="display: none;">填入学生信息表单</button>
                    </div>
                    <div class="table-container">
                        <table id="previewTable" class="data-table">
                            <thead>
                                <tr id="tableHeader"></tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 学生信息录入页面 -->
        <div id="input-tab" class="tab-content">
            <div class="form-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">学生基本信息</h2>
                    <button type="button" class="btn btn-primary" onclick="fillRecommendationPage()">填入推荐信息</button>
                </div>
                <form id="student-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="studentName">学生姓名 *</label>
                            <input type="text" id="studentName" name="studentName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">性别 *</label>
                            <select id="gender" name="gender" required>
                                <option value="">请选择</option>
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="grade">所在年级 *</label>
                            <select id="grade" name="grade" required>
                                <option value="">请选择</option>
                                <option value="高一">高一</option>
                                <option value="高二">高二</option>
                                <option value="高三">高三</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="school">所在学校名称 *</label>
                            <input type="text" id="school" name="school" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="subjectGroup">高考学科分组 *</label>
                            <select id="subjectGroup" name="subjectGroup" required>
                                <option value="">请选择</option>
                                <option value="物理组">物理组</option>
                                <option value="历史组">历史组</option>
                            </select>
                        </div>
                    </div>

                    <h3>学业成绩</h3>
                    <div class="scores-section">
                        <h4>最近一次考试成绩</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="currentChinese">语文</label>
                                <input type="number" id="currentChinese" name="currentChinese" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="currentMath">数学</label>
                                <input type="number" id="currentMath" name="currentMath" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="currentEnglish">英语</label>
                                <input type="number" id="currentEnglish" name="currentEnglish" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="currentPhysics">物理</label>
                                <input type="number" id="currentPhysics" name="currentPhysics" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="currentBiology">生物</label>
                                <input type="number" id="currentBiology" name="currentBiology" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="currentChemistry">化学</label>
                                <input type="number" id="currentChemistry" name="currentChemistry" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="currentHistory">历史</label>
                                <input type="number" id="currentHistory" name="currentHistory" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="currentPolitics">政治</label>
                                <input type="number" id="currentPolitics" name="currentPolitics" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="currentGeography">地理</label>
                                <input type="number" id="currentGeography" name="currentGeography" min="0" max="100">
                            </div>                     
                            <div class="form-group">
                                <label for="currentTotal">总分</label>
                                <input type="number" id="currentTotal" name="currentTotal" min="0" max="750">
                            </div>
                        </div>

                        <h4>预测高考成绩</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="predictedChinese">语文</label>
                                <input type="number" id="predictedChinese" name="predictedChinese" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="predictedMath">数学</label>
                                <input type="number" id="predictedMath" name="predictedMath" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="predictedEnglish">英语</label>
                                <input type="number" id="predictedEnglish" name="predictedEnglish" min="0" max="150">
                            </div>
                            <div class="form-group">
                                <label for="predictedPhysics">物理</label>
                                <input type="number" id="predictedPhysics" name="predictedPhysics" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedBiology">生物</label>
                                <input type="number" id="predictedBiology" name="predictedBiology" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedChemistry">化学</label>
                                <input type="number" id="predictedChemistry" name="predictedChemistry" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedHistory">历史</label>
                                <input type="number" id="predictedHistory" name="predictedHistory" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedPolitics">政治</label>
                                <input type="number" id="predictedPolitics" name="predictedPolitics" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedGeography">地理</label>
                                <input type="number" id="predictedGeography" name="predictedGeography" min="0" max="100">
                            </div>
                            <div class="form-group">
                                <label for="predictedTotal">总分</label>
                                <input type="number" id="predictedTotal" name="predictedTotal" min="0" max="750">
                            </div>
                        </div>
                    </div>

                    <h3>学业水平考试</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="academicLevelPass">是否通过学业水平考试</label>
                            <select id="academicLevelPass" name="academicLevelPass">
                                <option value="">请选择</option>
                                <option value="是">是</option>
                                <option value="否">否</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="academicSubject1">科目1(科目)</label>
                            <input type="text" id="academicSubject1" name="academicSubject1" placeholder="请输入科目名称">
                        </div>
                        <div class="form-group">
                            <label for="academicScore1">科目1(分数)</label>
                            <input type="number" id="academicScore1" name="academicScore1" min="0" max="100" placeholder="请输入分数">
                        </div>
                        <div class="form-group">
                            <label for="academicSubject2">科目2(科目)</label>
                            <input type="text" id="academicSubject2" name="academicSubject2" placeholder="请输入科目名称">
                        </div>
                        <div class="form-group">
                            <label for="academicScore2">科目2(分数)</label>
                            <input type="number" id="academicScore2" name="academicScore2" min="0" max="100" placeholder="请输入分数">
                        </div>
                        <div class="form-group">
                            <label for="academicSubject3">科目3(科目)</label>
                            <input type="text" id="academicSubject3" name="academicSubject3" placeholder="请输入科目名称">
                        </div>
                        <div class="form-group">
                            <label for="academicScore3">科目3(分数)</label>
                            <input type="number" id="academicScore3" name="academicScore3" min="0" max="100" placeholder="请输入分数">
                        </div>
                    </div>

                    <h3>补习情况</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="hasTutoring">是否进行学科补习</label>
                            <select id="hasTutoring" name="hasTutoring">
                                <option value="">请选择</option>
                                <option value="是">是</option>
                                <option value="否">否</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tutoringSubjects">正在补习的科目</label>
                            <input type="text" id="tutoringSubjects" name="tutoringSubjects" placeholder="多个科目请用逗号分隔">
                        </div>
                    </div>

                    <h3>专业倾向与留学意向</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>大学倾向专业方向</label>
                            <div class="checkbox-group" id="majorPreferenceGroup">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_building" name="majorPreference" value="建筑">
                                    <label for="major_building">建筑</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_science" name="majorPreference" value="理科">
                                    <label for="major_science">理科</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_engineering" name="majorPreference" value="工科">
                                    <label for="major_engineering">工科</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_business" name="majorPreference" value="商科">
                                    <label for="major_business">商科</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_liberal" name="majorPreference" value="文科">
                                    <label for="major_liberal">文科</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_medical" name="majorPreference" value="医护">
                                    <label for="major_medical">医护</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_music" name="majorPreference" value="音乐">
                                    <label for="major_music">音乐</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_art" name="majorPreference" value="美术">
                                    <label for="major_art">美术</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="major_other" name="majorPreference" value="其他">
                                    <label for="major_other">其他</label>
                                </div>
                            </div>
                        </div>
                        
                    </div>

                    <h3>国际英语成绩</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="englishTestType">国际英语成绩类型</label>
                            <select id="englishTestType" name="englishTestType">
                                <option value="">请选择</option>
                                <option value="雅思">雅思</option>
                                <option value="托福">托福</option>
                                <option value="PTE">PTE</option>
                                <option value="多邻国">多邻国</option>
                                <option value="暂无">暂无</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="englishTotalScore">总分</label>
                            <input type="text" id="englishTotalScore" name="englishTotalScore" placeholder="请输入总分">
                        </div>
                        
                        <div class="form-group">
                            <label for="englishListening">听力</label>
                            <input type="text" id="englishListening" name="englishListening" placeholder="请输入听力成绩">
                        </div>
                        
                        <div class="form-group">
                            <label for="englishReading">阅读</label>
                            <input type="text" id="englishReading" name="englishReading" placeholder="请输入阅读成绩">
                        </div>
                        
                        <div class="form-group">
                            <label for="englishSpeaking">口语</label>
                            <input type="text" id="englishSpeaking" name="englishSpeaking" placeholder="请输入口语成绩">
                        </div>
                        
                        <div class="form-group">
                            <label for="englishWriting">写作</label>
                            <input type="text" id="englishWriting" name="englishWriting" placeholder="请输入写作成绩">
                        </div>
                    </div>

                    <h3>留学意向</h3>
                    <div class="form-grid">
                        
                        <div class="form-group">
                            <label>留学意向国家/地区</label>
                            <div class="checkbox-group" id="studyDestinationGroup">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_usa" name="studyDestination" value="美国">
                                    <label for="destination_usa">🇺🇸 美国</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_uk" name="studyDestination" value="英国">
                                    <label for="destination_uk">🇬🇧 英国</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_australia" name="studyDestination" value="澳大利亚">
                                    <label for="destination_australia">🇦🇺 澳大利亚</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_hongkong" name="studyDestination" value="中国香港">
                                    <label for="destination_hongkong">🇭🇰 中国香港</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_macao" name="studyDestination" value="中国澳门">
                                    <label for="destination_macao">🇲🇴 中国澳门</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_singapore" name="studyDestination" value="新加坡">
                                    <label for="destination_singapore">🇸🇬 新加坡</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_malaysia" name="studyDestination" value="马来西亚">
                                    <label for="destination_malaysia">🇲🇾 马来西亚</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_canada" name="studyDestination" value="加拿大">
                                    <label for="destination_canada">🇨🇦 加拿大</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_netherlands" name="studyDestination" value="荷兰">
                                    <label for="destination_netherlands">🇳🇱 荷兰</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="destination_newzealand" name="studyDestination" value="新西兰">
                                    <label for="destination_newzealand">🇳🇿 新西兰</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="budget">预期留学投入费用</label>
                            <select id="budget" name="budget">
                                <option value="">请选择</option>
                                <option value="80万以内">80万以内</option>
                                <option value="100万以内">100万以内</option>
                                <option value="120万以内">120万以内</option>
                                <option value="150万以内">150万以内</option>
                                <option value="200万以内">200万以内</option>
                                <option value="200万以上">200万以上</option>
                            </select>
                        </div>
                    </div>

                    <h3>课外活动与个人素养</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="hasClub">是否参加学校社团</label>
                            <select id="hasClub" name="hasClub">
                                <option value="">请选择</option>
                                <option value="是">是</option>
                                <option value="否">否</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="clubActivities">参加的社团</label>
                            <input type="text" id="clubActivities" name="clubActivities" placeholder="多个社团请用逗号分隔">
                        </div>
                        
                        <div class="form-group">
                            <label for="hasLongTermHobby">是否有维持3年以上的兴趣爱好</label>
                            <select id="hasLongTermHobby" name="hasLongTermHobby">
                                <option value="">请选择</option>
                                <option value="是">是</option>
                                <option value="否">否</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="hobbies">兴趣爱好</label>
                            <input type="text" id="hobbies" name="hobbies" placeholder="多个爱好请用逗号分隔">
                        </div>
                        
                        <div class="form-group">
                            <label for="friendsCount">经常来往的好友数量</label>
                            <select id="friendsCount" name="friendsCount">
                                <option value="">请选择</option>
                                <option value="没有">没有</option>
                                <option value="1-3个">1-3个</option>
                                <option value="3-5个">3-5个</option>
                                <option value="5个以上">5个以上</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="talents">持续学习3年以上的才艺</label>
                            <input type="text" id="talents" name="talents" placeholder="多个才艺请用┋分隔，如：音乐┋舞蹈┋体育">
                        </div>
                        
                        <div class="form-group">
                            <label for="certificates">才艺证书资质或奖项</label>
                            <input type="text" id="certificates" name="certificates" placeholder="多个证书请用逗号分隔">
                        </div>
                        
                        <div class="form-group">
                            <label for="organizationFrequency">整理生活和工作空间频率</label>
                            <select id="organizationFrequency" name="organizationFrequency">
                                <option value="">请选择</option>
                                <option value="每天至少一次">每天至少一次</option>
                                <option value="每周至少一次">每周至少一次</option>
                                <option value="每月至少一次">每月至少一次</option>
                                <option value="半年至少一次">半年至少一次</option>
                                <option value="从不整理">从不整理</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="askForHelp">遇到困难是否向周围的人求助</label>
                            <input type="text" id="askForHelp" name="askForHelp" placeholder="请填写学生的应对方式">
                        </div>
                        
                        <div class="form-group">
                            <label for="studyPersistence">学习中遇到阻碍时的坚持程度</label>
                            <input type="text" id="studyPersistence" name="studyPersistence" placeholder="请填写学生的坚持程度">
                        </div>
                        
                        <div class="form-group">
                            <label for="internationalExperience">国外生活经历时长</label>
                            <select id="internationalExperience" name="internationalExperience">
                                <option value="">请选择</option>
                                <option value="从来没有">从来没有</option>
                                <option value="一个月以内">一个月以内</option>
                                <option value="6个月以内">6个月以内</option>
                                <option value="一年以内">一年以内</option>
                                <option value="一年以上">一年以上</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="campExperience">是否参加过夏令营/冬令营</label>
                            <select id="campExperience" name="campExperience">
                                <option value="">请选择</option>
                                <option value="是">是</option>
                                <option value="否">否</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="canCook">做饭水平</label>
                            <input type="text" id="canCook" name="canCook" placeholder="请填写学生的做饭水平描述">
                        </div>
                        
                        <div class="form-group">
                            <label for="readingTime">每天课外阅读时间（小时）</label>
                            <input type="number" id="readingTime" name="readingTime" min="0" max="8" step="0.5" placeholder="请输入0-8的数字，支持0.5">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="fillRecommendationPage()">填入推荐信息</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 问卷管理页面 -->
        <div id="surveys-tab" class="tab-content">
            <div class="form-container">
                <h2>问卷管理</h2>
                
                <!-- 问卷列表区域 -->
                <div class="admin-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>📋 已提交问卷列表</h3>
                        <button type="button" class="btn btn-primary" onclick="loadSurveys()">🔄 刷新列表</button>
                    </div>
                    <div id="surveysListContainer" style="background: white; border-radius: 10px; overflow: hidden;">
                        <div style="text-align: center; color: #718096; padding: 40px;">
                            <p>正在加载问卷数据...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 机构码管理页面 -->
        <div id="institutions-tab" class="tab-content">
            <div class="form-container">
                <h2>机构码管理</h2>
                
                <!-- 添加机构码表单 -->
                <div class="admin-section" style="margin-bottom: 30px;">
                    <h3>添加新机构码</h3>
                    <form id="institutionForm" onsubmit="handleInstitutionSubmit(event)" style="display: grid; grid-template-columns: 1fr 1fr auto auto; gap: 15px; align-items: end;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="institutionCode">机构码 *</label>
                            <input type="text" id="institutionCode" name="code" required placeholder="请输入机构码或点击生成">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="institutionName">机构名称</label>
                            <input type="text" id="institutionName" name="name" placeholder="请输入机构名称（可选）">
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="generateRandomCode()" style="white-space: nowrap;">🎲 随机生成</button>
                        <button type="submit" class="btn btn-primary">添加机构码</button>
                    </form>
                </div>
                
                <!-- 机构码列表 -->
                <div class="admin-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>机构码列表</h3>
                        <button type="button" class="btn btn-secondary" onclick="loadInstitutions()">🔄 刷新列表</button>
                    </div>
                    <div id="institutionsListContainer" style="background: white; border-radius: 10px; overflow: hidden;">
                        <div style="text-align: center; color: #718096; padding: 40px;">
                            <p>正在加载机构码数据...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 推荐信息录入页面 -->
        <div id="admin-tab" class="tab-content">
            <div class="admin-container">
                <h2>推荐信息录入</h2>
                
                <!-- 状态提示区域 -->
                <div class="status-banner" id="admin-status">
                    <div class="status-info">
                        <span class="status-icon">ℹ️</span>
                        <span class="status-text" id="status-text">在这里可以自定义报告的所有内容。配置完成后可以直接生成报告预览。</span>
                    </div>
                    <button type="button" class="btn btn-primary btn-small" onclick="generateReportFromAdmin()">📊 生成报告</button>
                </div>
                
                <div class="admin-section">
                    <h3>雷达图维度设置</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="academicAbility">学术能力 (0-100)</label>
                            <input type="number" id="academicAbility" name="academicAbility" min="0" max="100" value="75">
                        </div>
                        <div class="form-group">
                            <label for="languageAbility">语言能力 (0-100)</label>
                            <input type="number" id="languageAbility" name="languageAbility" min="0" max="100" value="70">
                        </div>
                        <div class="form-group">
                            <label for="artisticQuality">文体素养 (0-100)</label>
                            <input type="number" id="artisticQuality" name="artisticQuality" min="0" max="100" value="80">
                        </div>
                        <div class="form-group">
                            <label for="socialAbility">生活能力 (0-100)</label>
                            <input type="number" id="socialAbility" name="socialAbility" min="0" max="100" value="85">
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>四维能力详细分析</h3>
                    <p class="section-desc">分析内容根据学生信息录入的计算结果自动生成，可手动编辑调整。</p>
                    
                    <!-- 学术能力分析 -->
                    <div class="ability-analysis">
                        <h4>📚 学术能力分析</h4>
                        <div class="form-group">
                            <label for="academicAnalysis">详细分析</label>
                            <textarea id="academicAnalysis" name="academicAnalysis" rows="4" placeholder="根据学术能力分数自动生成分析内容"></textarea>
                        </div>
                    </div>

                    <!-- 语言能力分析 -->
                    <div class="ability-analysis">
                        <h4>🌍 语言能力分析</h4>
                        <div class="form-group">
                            <label for="languageAnalysis">详细分析</label>
                            <textarea id="languageAnalysis" name="languageAnalysis" rows="4" placeholder="根据语言能力分数自动生成分析内容"></textarea>
                        </div>
                    </div>

                    <!-- 文体素养分析 -->
                    <div class="ability-analysis">
                        <h4>🎨 文体素养分析</h4>
                        <div class="form-group">
                            <label for="artisticAnalysis">详细分析</label>
                            <textarea id="artisticAnalysis" name="artisticAnalysis" rows="4" placeholder="根据文体素养分数自动生成分析内容"></textarea>
                        </div>
                    </div>

                    <!-- 生活能力分析 -->
                    <div class="ability-analysis">
                        <h4>🏠 生活能力分析</h4>
                        <div class="form-group">
                            <label for="socialAnalysis">详细分析</label>
                            <textarea id="socialAnalysis" name="socialAnalysis" rows="4" placeholder="根据生活能力分数自动生成分析内容"></textarea>
                        </div>
                    </div>


                    <div class="admin-section">
                        <h3>综合提升建议</h3>
                        <div class="form-group">
                            <label for="overallSuggestions">整体建议</label>
                            <textarea id="overallSuggestions" name="overallSuggestions" rows="4" placeholder="留空则根据四维分析自动汇总生成">1. 加强英语听说读写能力，建议参加雅思或托福培训
2. 扩展学术课外活动，如科研项目或学科竞赛
3. 发展文体特长，参与相关比赛和活动
4. 培养独立生活技能，为留学做好准备</textarea>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>院校与专业推荐</h3>
                    
                    <h4>冲刺院校（2所）</h4>
                    <div class="university-grid">
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="reach1Name" value="剑桥大学">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('reach1')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="reach1Major" value="工程学">
                            <input type="text" placeholder="地区" id="reach1Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="reach1Logo" value="https://via.placeholder.com/60x60?text=剑桥">
                            <textarea placeholder="推荐理由（约20字）" id="reach1Reason" rows="2">世界顶尖学府，工程专业排名全球前3，学术声誉卓越</textarea>
                        </div>
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="reach2Name" value="帝国理工学院">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('reach2')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="reach2Major" value="计算机科学">
                            <input type="text" placeholder="地区" id="reach2Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="reach2Logo" value="https://via.placeholder.com/60x60?text=帝国">
                            <textarea placeholder="推荐理由（约20字）" id="reach2Reason" rows="2">计算机科学全球领先，就业前景极佳，科研实力雄厚</textarea>
                        </div>
                    </div>

                    <h4>稳妥院校（2所）</h4>
                    <div class="university-grid">
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="match1Name" value="曼彻斯特大学">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('match1')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="match1Major" value="电子工程">
                            <input type="text" placeholder="地区" id="match1Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="match1Logo" value="https://via.placeholder.com/60x60?text=曼大">
                            <textarea placeholder="推荐理由（约20字）" id="match1Reason" rows="2">电子工程专业实力强劲，工业界认可度高，就业稳定</textarea>
                        </div>
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="match2Name" value="伯明翰大学">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('match2')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="match2Major" value="机械工程">
                            <input type="text" placeholder="地区" id="match2Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="match2Logo" value="https://via.placeholder.com/60x60?text=伯明翰">
                            <textarea placeholder="推荐理由（约20字）" id="match2Reason" rows="2">机械工程历史悠久，实践教学丰富，毕业生就业率高</textarea>
                        </div>
                    </div>

                    <h4>保底院校（2所）</h4>
                    <div class="university-grid">
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="safety1Name" value="利兹大学">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('safety1')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="safety1Major" value="土木工程">
                            <input type="text" placeholder="地区" id="safety1Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="safety1Logo" value="https://via.placeholder.com/60x60?text=利兹">
                            <textarea placeholder="推荐理由（约20字）" id="safety1Reason" rows="2">土木工程专业扎实，课程设置实用，性价比高</textarea>
                        </div>
                        <div class="university-item">
                            <div class="university-name-row">
                                <input type="text" placeholder="大学名称" id="safety2Name" value="谢菲尔德大学">
                                <button type="button" class="select-university-btn" onclick="openUniversitySelector('safety2')">选择大学</button>
                            </div>
                            <input type="text" placeholder="专业名称" id="safety2Major" value="材料科学">
                            <input type="text" placeholder="地区" id="safety2Location" value="英国">
                            <input type="url" placeholder="校徽URL" id="safety2Logo" value="https://via.placeholder.com/60x60?text=谢菲">
                            <textarea placeholder="推荐理由（约20字）" id="safety2Reason" rows="2">材料科学领域知名，研究环境优良，申请门槛适中</textarea>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>服务引流模块</h3>
                    <div class="form-group">
                        <label for="serviceTitle">主标题</label>
                        <input type="text" id="serviceTitle" name="serviceTitle" placeholder="请输入主标题..." value="高考成绩锁定海外名校！">
                    </div>
                    <div class="form-group">
                        <label for="serviceSubtitle">副标题</label>
                        <input type="text" id="serviceSubtitle" name="serviceSubtitle" placeholder="请输入副标题..." value="联系我们获取更多高考海外升学资讯及个性化解决方案">
                    </div>
                    <div class="form-group">
                        <label for="qrCodeImage">二维码图片</label>
                        <input type="url" id="qrCodeImage" name="qrCodeImage" placeholder="请输入二维码图片URL（留空使用默认图片）..." value="">
                        <small class="form-help">留空将使用默认二维码图片</small>
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">联系邮箱</label>
                        <input type="email" id="contactEmail" name="contactEmail" placeholder="请输入联系邮箱..." value="maerzchen@live.com">
                    </div>
                    <div class="form-group">
                        <label for="techSupport">技术支持机构</label>
                        <input type="text" id="techSupport" name="techSupport" placeholder="请输入技术支持机构名称..." value="未名教育">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="saveAdminSettings()">保存设置</button>
                    <button type="button" class="btn btn-primary" onclick="generateReportFromAdmin()">📊 生成报告</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 大学选择器模态框 -->
    <div id="universitySelectorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择大学</h3>
                <span class="close" onclick="closeUniversitySelector()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="search-section">
                    <input type="text" id="universitySearch" placeholder="搜索大学名称..." onkeyup="filterUniversities()">
                    <div class="filter-buttons">
                        <button type="button" class="filter-btn active" onclick="filterByCountry('all')">全部</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('美国')">美国</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('英国')">英国</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('中国')">中国</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('澳大利亚')">澳大利亚</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('加拿大')">加拿大</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('德国')">德国</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('日本')">日本</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('韩国')">韩国</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('新加坡')">新加坡</button>
                        <button type="button" class="filter-btn" onclick="filterByCountry('其他')">其他</button>
                    </div>
                </div>
                <div class="universities-list" id="universitiesList">
                    <!-- 大学列表将在这里动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeUniversitySelector()">取消</button>
            </div>
        </div>
    </div>

    <script src="scripts/university-data.js"></script>
    <script src="scripts/main.js"></script>
    <script>
        // API基础URL
        const API_BASE_URL = '/api';
        
        // 加载问卷列表
        async function loadSurveys() {
            const container = document.getElementById('surveysListContainer');
            container.innerHTML = '<div style="text-align: center; color: #718096; padding: 40px;"><p>正在加载问卷数据...</p></div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/surveys`);
                const surveys = await response.json();
                
                if (!response.ok) {
                    throw new Error(surveys.error || '加载失败');
                }
                
                if (surveys.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #718096; padding: 40px;"><p>暂无已提交的问卷</p></div>';
                    return;
                }
                
                // 渲染问卷列表为表格形式
                let html = `
                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f7fafc; border-bottom: 2px solid #e2e8f0;">
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">学生姓名</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">机构码</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">年级</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">学校</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">提交时间</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; font-size: 0.9rem;">状态</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; font-size: 0.9rem;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                surveys.forEach((survey, index) => {
                    const surveyData = survey.survey_data;
                    const submitTime = new Date(survey.created_at).toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const statusBadge = survey.status === 'completed' ? 
                        '<span style="background: #48bb78; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">已完成</span>' :
                        '<span style="background: #ed8936; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">待处理</span>';
                    
                    const rowBg = index % 2 === 0 ? '#ffffff' : '#f7fafc';
                    const studentName = survey.student_name || surveyData.studentName || surveyData.student_name || '未知';
                    const institutionCode = survey.institution_code || '-';
                    const institutionName = survey.institution_name ? `(${survey.institution_name})` : '';
                    const grade = surveyData.grade || '-';
                    const school = surveyData.school || '-';
                    
                    html += `
                        <tr style="background: ${rowBg}; border-bottom: 1px solid #e2e8f0; cursor: pointer;" 
                            onmouseover="this.style.background='#edf2f7'" 
                            onmouseout="this.style.background='${rowBg}'">
                            <td style="padding: 12px; color: #2d3748; font-weight: 500;">${studentName}</td>
                            <td style="padding: 12px; color: #4a5568; font-size: 0.9rem;">
                                ${institutionCode} ${institutionName}
                            </td>
                            <td style="padding: 12px; color: #4a5568;">${grade}</td>
                            <td style="padding: 12px; color: #4a5568; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${school}">${school}</td>
                            <td style="padding: 12px; color: #718096; font-size: 0.85rem;">${submitTime}</td>
                            <td style="padding: 12px; text-align: center;">${statusBadge}</td>
                            <td style="padding: 12px; text-align: center;">
                                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 0.85rem;" 
                                        onclick="event.stopPropagation(); viewSurveyDetails(${survey.id})">
                                    查看详情
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                container.innerHTML = html;
            } catch (error) {
                console.error('加载问卷列表错误:', error);
                container.innerHTML = `<div style="text-align: center; color: #e53e3e; padding: 40px;"><p>加载失败: ${error.message}</p><button class="btn btn-primary" onclick="loadSurveys()">重试</button></div>`;
            }
        }
        
        // 查看问卷详情
        async function viewSurveyDetails(surveyId) {
            try {
                const response = await fetch(`${API_BASE_URL}/surveys/${surveyId}`);
                const survey = await response.json();
                
                if (!response.ok) {
                    alert(survey.error || '加载失败');
                    return;
                }
                
                // 填充到学生信息录入表单
                const surveyData = survey.survey_data;
                
                // 填充基本信息
                if (surveyData.studentName || surveyData.student_name) {
                    document.getElementById('studentName').value = surveyData.studentName || surveyData.student_name;
                }
                if (surveyData.gender) {
                    document.getElementById('gender').value = surveyData.gender;
                }
                if (surveyData.grade) {
                    document.getElementById('grade').value = surveyData.grade;
                }
                if (surveyData.school) {
                    document.getElementById('school').value = surveyData.school;
                }
                if (surveyData.subjectGroup) {
                    document.getElementById('subjectGroup').value = surveyData.subjectGroup;
                }
                
                // 填充成绩数据（这里可以继续添加更多字段）
                // 由于字段较多，可以调用main.js中已有的fillFormFromSurveyData函数
                if (typeof fillFormFromSurveyData === 'function') {
                    fillFormFromSurveyData(surveyData);
                }
                
                // 切换到学生信息录入标签页
                showTab('input');
                
                // 滚动到顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                alert(`已加载 ${survey.student_name || surveyData.studentName || '学生'} 的问卷数据，请检查并补充信息后生成报告。`);
            } catch (error) {
                console.error('加载问卷详情错误:', error);
                alert('加载问卷详情失败');
            }
        }
        
        // 页面加载时自动加载问卷列表
        document.addEventListener('DOMContentLoaded', function() {
            // 如果当前在surveys标签页，则加载问卷列表
            if (document.getElementById('surveys-tab').classList.contains('active')) {
                loadSurveys();
            }
        });
        
        // 监听标签页切换
        const originalShowTab = window.showTab;
        window.showTab = function(tabName) {
            if (typeof originalShowTab === 'function') {
                originalShowTab(tabName);
            }
            if (tabName === 'surveys') {
                loadSurveys();
            }
            if (tabName === 'institutions') {
                loadInstitutions();
            }
        };
        
        // ========== 机构码管理功能 ==========
        
        // 生成随机10位数字机构码
        function generateRandomCode() {
            // 生成10位随机数字
            let code = '';
            for (let i = 0; i < 10; i++) {
                code += Math.floor(Math.random() * 10);
            }
            
            // 填充到输入框
            document.getElementById('institutionCode').value = code;
            
            // 可选：自动聚焦到机构名称输入框
            document.getElementById('institutionName').focus();
        }
        
        // 加载机构码列表
        async function loadInstitutions() {
            const container = document.getElementById('institutionsListContainer');
            container.innerHTML = '<div style="text-align: center; color: #718096; padding: 40px; background: white;"><p>正在加载机构码数据...</p></div>';
            
            try {
                const response = await fetch(`${API_BASE_URL}/institutions`);
                const institutions = await response.json();
                
                if (!response.ok) {
                    throw new Error(institutions.error || '加载失败');
                }
                
                if (institutions.length === 0) {
                    container.innerHTML = '<div style="text-align: center; color: #718096; padding: 40px; background: white;"><p>暂无机构码，请添加</p></div>';
                    return;
                }
                
                // 渲染机构码列表为表格形式
                let html = `
                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #f7fafc; border-bottom: 2px solid #e2e8f0;">
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">机构码</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">机构名称</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #2d3748; font-size: 0.9rem;">创建时间</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; font-size: 0.9rem;">状态</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600; color: #2d3748; font-size: 0.9rem;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                institutions.forEach((inst, index) => {
                    const createdTime = new Date(inst.created_at).toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const statusBadge = inst.is_completed === 1 ? 
                        '<span style="background: #48bb78; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">已使用</span>' :
                        '<span style="background: #cbd5e0; color: #4a5568; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;">未使用</span>';
                    
                    const rowBg = index % 2 === 0 ? '#ffffff' : '#f7fafc';
                    const institutionName = inst.name || '-';
                    const safeName = (inst.name || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                    
                    html += `
                        <tr style="background: ${rowBg}; border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px; color: #2d3748; font-weight: 500; font-family: monospace;">
                                <span id="code-display-${inst.id}">${inst.code}</span>
                            </td>
                            <td style="padding: 12px; color: #4a5568;">${institutionName}</td>
                            <td style="padding: 12px; color: #718096; font-size: 0.85rem;">${createdTime}</td>
                            <td style="padding: 12px; text-align: center;">${statusBadge}</td>
                            <td style="padding: 12px; text-align: center;">
                                <div style="display: flex; gap: 8px; justify-content: center;">
                                    <button class="btn btn-secondary" 
                                            onclick="editInstitution(${inst.id}, '${inst.code}', '${safeName}')" 
                                            style="padding: 6px 12px; font-size: 0.85rem;">
                                        ✏️ 编辑
                                    </button>
                                    <button class="btn btn-danger" 
                                            onclick="deleteInstitutionConfirm(${inst.id}, '${inst.code}')" 
                                            style="padding: 6px 12px; font-size: 0.85rem;">
                                        🗑️ 删除
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
                
                container.innerHTML = html;
            } catch (error) {
                console.error('加载机构码列表错误:', error);
                container.innerHTML = `<div style="text-align: center; color: #e53e3e; padding: 40px;"><p>加载失败: ${error.message}</p><button class="btn btn-primary" onclick="loadInstitutions()">重试</button></div>`;
            }
        }
        
        // 添加机构码
        async function handleInstitutionSubmit(event) {
            event.preventDefault();
            
            const code = document.getElementById('institutionCode').value.trim();
            const name = document.getElementById('institutionName').value.trim();
            
            if (!code) {
                alert('请输入机构码');
                return;
            }
            
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '添加中...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/institutions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code, name: name || null })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    alert(data.error || '添加失败');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                    return;
                }
                
                // 清空表单
                document.getElementById('institutionForm').reset();
                
                // 刷新列表
                loadInstitutions();
                
                alert('机构码添加成功！');
            } catch (error) {
                console.error('添加机构码错误:', error);
                alert('网络错误，请稍后重试');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }
        
        // 编辑机构码
        function editInstitution(id, code, name) {
            const newCode = prompt('请输入新的机构码:', code);
            if (!newCode || newCode.trim() === '') {
                return;
            }
            
            const newName = prompt('请输入新的机构名称（留空则删除名称）:', name || '');
            
            updateInstitution(id, newCode.trim(), newName ? newName.trim() : null);
        }
        
        // 更新机构码
        async function updateInstitution(id, code, name) {
            try {
                const response = await fetch(`${API_BASE_URL}/institutions/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ code, name })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    alert(data.error || '更新失败');
                    return;
                }
                
                // 刷新列表
                loadInstitutions();
                
                alert('机构码更新成功！');
            } catch (error) {
                console.error('更新机构码错误:', error);
                alert('网络错误，请稍后重试');
            }
        }
        
        // 删除机构码确认
        function deleteInstitutionConfirm(id, code) {
            if (!confirm(`确定要删除机构码 "${code}" 吗？\n\n注意：删除后该机构码将无法再使用，但已提交的问卷数据不会受影响。`)) {
                return;
            }
            
            deleteInstitution(id);
        }
        
        // 删除机构码
        async function deleteInstitution(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/institutions/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    alert(data.error || '删除失败');
                    return;
                }
                
                // 刷新列表
                loadInstitutions();
                
                alert('机构码删除成功！');
            } catch (error) {
                console.error('删除机构码错误:', error);
                alert('网络错误，请稍后重试');
            }
        }
    </script>
</body>
</html> 